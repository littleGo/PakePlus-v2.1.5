import{d as e,r as a,a as t,o as l,b as n,g as s,j as o,m as r,l as i,u as d,T as p,i as u,h as c,Y as b,am as m,a4 as g,x as f,s as y,v as h,an as v,ao as w,k as x,n as D,R as P,V as k,_}from"./chunk-gpwU6gGF.js";import{_ as R}from"./chunk-CZwVIX7D.js";import{i as T,u as C,a as A,l as O,b as L}from"./chunk-CvT-8fpa.js";import{_ as N}from"./chunk-BgADtg68.js";import{r as j,a as z}from"./chunk-DsM932Ci.js";const F={class:"drawer drawer-end h-0 w-0"},W={class:"drawer-content w-0 h-0 absolute"},S={class:"drawer-side"},E={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},U=e({__name:"index",setup(e,{expose:r}){const i=a(null),d=a(!1);return r({showDrawer:function(){i.value?.click(),d.value=!0},closeDrawer:function(){i.value?.click(),d.value=!1}}),(e,a)=>(l(),t("div",F,[a[1]||(a[1]=n("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),n("div",W,[n("label",{ref_key:"drawerTriggerRef",ref:i,for:"my-drawer-1"},null,512)]),n("div",S,[a[0]||(a[0]=n("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),d.value?(l(),t("div",E,[o(e.$slots,"content")])):s("",!0)])]))}}),I={class:"fieldset"},V={class:"label"},$=["placeholder"],q={class:"fieldset"},J={class:"label",required:""},M=["placeholder"],Y={class:"validator-hint hidden"},B={class:"fieldset"},G={class:"label"},H=["placeholder"],K={class:"fieldset"},Q={class:"label"},X=["placeholder"],Z={class:"btn btn-neutral mt-4",type:"submit"},ee=e({__name:"SinglePerson",props:r({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(e){const{t:a}=i(),s=d(e,"singlePersonData");return(o,r)=>(l(),t("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:r[5]||(r[5]=a=>e.addOnePerson(e.addOnePersonDrawerRef,a))},[n("label",I,[n("span",V,u(c(a)("table.number")),1),p(n("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>s.value.uid=e),type:"text",class:"input validator",placeholder:c(a)("table.number")},null,8,$),[[b,s.value.uid]])]),n("fieldset",q,[n("label",J,[m(u(c(a)("table.name")),1),r[6]||(r[6]=n("span",{class:"text-red-500"},"*",-1))]),p(n("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>s.value.name=e),type:"text",class:"input validator",placeholder:c(a)("table.name"),required:"",minlength:"1"},null,8,M),[[b,s.value.name]]),n("p",Y,u(c(a)("error.personNameEmpty")),1)]),n("label",B,[n("span",G,u(c(a)("table.department")),1),p(n("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>s.value.department=e),type:"text",class:"input validator",placeholder:c(a)("table.department")},null,8,H),[[b,s.value.department]])]),n("label",K,[n("span",Q,u(c(a)("table.identity")),1),p(n("input",{"onUpdate:modelValue":r[3]||(r[3]=e=>s.value.identity=e),type:"text",class:"input validator",placeholder:c(a)("table.identity")},null,8,X),[[b,s.value.identity]])]),n("button",Z,u(c(a)("button.confirm")),1),n("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:r[4]||(r[4]=a=>e.addOnePersonDrawerRef.closeDrawer())},u(c(a)("button.cancel")),1)],32))}});function ae(e){return new Worker(""+new URL("../assets/importExcel.worker-CWYp5aq3.js",import.meta.url).href,{name:e?.name})}function te({exportInputFileRef:e,addExportInputFileRef:t}){const{t:l}=i(),n="./".replace("./","/"),s=g.useToast(),o=new ae,r=x(O),d=C().personConfig,{getAllPersonList:p,getAlreadyPersonList:u}=f(d),c=(b={handleDeletePerson:function(e){d.deletePerson(e)}},[{label:T.global.t("data.number"),props:"uid"},{label:T.global.t("data.name"),props:"name"},{label:T.global.t("data.department"),props:"department"},{label:T.global.t("data.identity"),props:"identity"},{label:T.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?T.global.t("data.yes"):T.global.t("data.no")},{label:T.global.t("data.operation"),actions:[{label:T.global.t("data.delete"),type:"btn-error",onClick:e=>{b.handleDeletePerson(e)}}]}]);var b;const m=a(!1),D=a({uid:"",name:"",department:"",avatar:"",identity:""});async function P(){if("zhCn"===T.global.locale.value){return await z(`${n}人口登记表-zhCn.xlsx`)}return await z(`${n}personListTemplate-en.xlsx`)}async function k(e){var a;r?.show(),P(),a={type:"start",data:e,templateData:await P()},o&&o.postMessage(a)}return{resetData:function(){d.resetAlreadyPerson()},deleteAll:function(){d.deleteAllPerson()},handleFileChange:async function(a,n){o&&(o.onmessage=a=>{if("done"===a.data.type&&(n||d.resetPerson(),d.addNotPersonList(a.data.data),s.open({message:l("error.importSuccess"),type:"success",position:"top-right"}),function(){e.value&&(e.value.value="");t&&(t.value.value="")}()),"error"===a.data.type){if("not right template"===a.data.message)return void s.open({message:l("error.excelFileError"),type:"error",position:"top-right"});s.open({message:a.data.message||l("error.importFail"),type:"error",position:"top-right"})}r?.hide()}),k(await j(a.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(p.value));for(let t=0;t<e.length;t++)delete e[t].x,delete e[t].y,delete e[t].id,delete e[t].createTime,delete e[t].updateTime,delete e[t].prizeId,e[t].isWin?e[t].isWin=T.global.t("data.yes"):e[t].isWin=T.global.t("data.no"),e[t].prizeTime=e[t].prizeTime.join(","),e[t].prizeName=e[t].prizeName.join(",");let a=JSON.stringify(e);if(a=a.replaceAll(/uid/g,T.global.t("data.number")).replaceAll(/isWin/g,T.global.t("data.isWin")).replaceAll(/department/g,T.global.t("data.department")).replaceAll(/name/g,T.global.t("data.name")).replaceAll(/identity/g,T.global.t("data.identity")).replaceAll(/prizeName/g,T.global.t("data.prizeName")).replaceAll(/prizeTime/g,T.global.t("data.prizeTime")),e=JSON.parse(a),e.length>0){const a=v.json_to_sheet(e),t=v.book_new();v.book_append_sheet(t,a,"Sheet1"),w(t,"data.xlsx")}},alreadyPersonList:u,allPersonList:p,tableColumnList:c,addOnePerson:function(e,a){a.preventDefault();const t=A([y(D.value)]);t[0].id=h(),d.addOnePerson(t),e.closeDrawer(),D.value={}},addPersonModalVisible:m,singlePersonData:D,downloadTemplate:function(){const e=T.global.t("data.xlsxName");fetch(`${n}${e}`).then(e=>e.blob()).then(a=>{const t=window.URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=e,n.click(),s.open({message:l("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const le={class:"min-w-1000px"},ne={class:"flex gap-3"},se=["data-tip"],oe={class:""},re={for:"explore"},ie=["data-tip"],de={class:"btn btn-primary btn-sm"},pe={class:""},ue={for:"add-explore"},ce={class:"tooltip tooltip-bottom","data-tip":"导入新增人员"},be=".xlsx,.xls",me=e({__name:"index",setup(e){const s=a(),o=a(),r=a(),d=a(),p=a(),{resetData:b,deleteAll:m,handleFileChange:g,exportData:f,addOnePerson:y,singlePersonData:h,alreadyPersonList:v,allPersonList:w,tableColumnList:x,downloadTemplate:T}=te({exportInputFileRef:r,addExportInputFileRef:d}),{t:C}=i();return(e,a)=>(l(),t(k,null,[D(L,{ref_key:"resetDataDialogRef",ref:s,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogResetWinner"),"submit-func":c(b)},null,8,["title","desc","submit-func"]),D(L,{ref_key:"delAllDataDialogRef",ref:o,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogDelAllPerson"),"submit-func":c(m)},null,8,["title","desc","submit-func"]),D(U,{ref_key:"addOnePersonDrawerRef",ref:p},{content:P(()=>[D(ee,{"single-person-data":c(h),"onUpdate:singlePersonData":a[0]||(a[0]=e=>_(h)?h.value=e:null),"add-one-person-drawer-ref":p.value,"add-one-person":c(y)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),n("div",le,[D(N,{title:c(C)("viewTitle.personManagement")},{buttons:P(()=>[n("div",ne,[n("button",{class:"btn btn-error btn-sm",onClick:a[1]||(a[1]=e=>o.value.showDialog())},u(c(C)("button.allDelete")),1),n("div",{class:"tooltip tooltip-bottom","data-tip":c(C)("tooltip.downloadTemplateTip")},[n("button",{class:"no-underline btn btn-secondary btn-sm",onClick:a[2]||(a[2]=(...e)=>c(T)&&c(T)(...e))},u(c(C)("button.downloadTemplate")),1)],8,se),n("div",oe,[n("label",re,[n("div",{class:"tooltip tooltip-bottom","data-tip":`${c(C)("tooltip.uploadExcelTip")}，全量覆盖，清空中奖人`},[n("input",{id:"explore",ref_key:"exportInputFileRef",ref:r,type:"file",class:"",style:{display:"none"},accept:be,onChange:a[3]||(a[3]=(...e)=>c(g)&&c(g)(...e))},null,544),n("span",de,u(c(C)("button.importData")),1)],8,ie)])]),n("button",{class:"btn btn-error btn-sm",onClick:a[4]||(a[4]=e=>s.value.showDialog())},u(c(C)("button.resetData")),1),n("button",{class:"btn btn-accent btn-sm",onClick:a[5]||(a[5]=(...e)=>c(f)&&c(f)(...e))},u(c(C)("button.exportResult")),1),n("button",{class:"btn btn-neutral btn-sm",onClick:a[6]||(a[6]=e=>p.value.showDrawer())},u(c(C)("button.add")),1),n("div",pe,[n("label",ue,[n("div",ce,[n("input",{id:"add-explore",ref_key:"addExportInputFileRef",ref:d,type:"file",class:"",style:{display:"none"},accept:be,onChange:a[7]||(a[7]=e=>c(g)(e,!0))},null,544),a[8]||(a[8]=n("span",{class:"btn btn-neutral btn-sm"},"添加导入",-1))])])]),n("div",null,[n("span",null,u(c(C)("table.luckyPeopleNumber"))+":",1),n("span",null,u(c(v).length),1),a[9]||(a[9]=n("span",null," / ",-1)),n("span",null,u(c(w).length),1)])])]),_:1},8,["title"]),D(R,{"table-columns":c(x),data:c(w)},null,8,["table-columns","data"])])],64))}});export{me as default};
