import{d as e,l as a,r as l,u as s,w as t,c as i,z as n,a as o,o as u,V as r,b as v,n as c,g as m,i as d,h as p,R as f,v as g,K as b,T as h,Y as k,x as y,W as w}from"./chunk-gpwU6gGF.js";import{u as x,b as I,f as _}from"./chunk-CvT-8fpa.js";import{_ as N}from"./chunk-BgADtg68.js";import{_ as j}from"./chunk-NcZwzitX.js";import"./chunk-DsM932Ci.js";const C={class:"toast toast-top toast-end"},S={key:0,class:"alert alert-error"},U={key:1,class:"alert alert-success"},D={key:2,class:"alert alert-error"},T={class:"flex flex-col items-center gap-6 w-full px-12"},q=["disabled","placeholder"],F=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:y}=a(),w=l("image/*"),_=l(0),N=s(e,"visible"),F=x().globalConfig,M=t.createInstance({name:"imgStore"}),R=l(null),V=i({get:()=>R.value?.fileName||null,set(e){R.value&&e&&(R.value.fileName=e)}}),z=l();async function B(e){if(!e)return void(R.value=null);/image*/.test(e?.type||"")?R.value=e:_.value=3}function H(){if(R.value){const{data:e,fileName:a}=R.value,l=g();M.setItem(l,{data:e,fileName:a}).then(()=>{_.value=1,async function(){(await M.keys()).length>0&&M.iterate((e,a)=>{F.addImage({id:a,name:e.fileName,url:"Storage"})})}()}).catch(()=>{_.value=2})}}return n(N,e=>{e&&z.value.showDialog()}),(e,a)=>(u(),o(r,null,[v("div",C,[2===_.value?(u(),o("div",S,[v("span",null,d(p(y)("error.uploadFail")),1)])):m("",!0),1===_.value?(u(),o("div",U,[v("span",null,d(p(y)("error.uploadSuccess")),1)])):m("",!0),3===_.value?(u(),o("div",D,[v("span",null,d(p(y)("error.notImage")),1)])):m("",!0)]),c(I,{ref_key:"uploadDialogRef",ref:z,visible:N.value,"onUpdate:visible":a[1]||(a[1]=e=>N.value=e),title:p(y)("dialog.uploadImageTitle"),"submit-func":H,class:""},{content:f(()=>[v("div",T,[N.value?(u(),b(j,{key:0,"limit-type":w.value,onUploadFile:B},null,8,["limit-type"])):m("",!0),h(v("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),disabled:null===R.value,type:"text",placeholder:p(y)("placeHolder.imageName"),class:"input w-full"},null,8,q),[[k,V.value]])])]),_:1},8,["visible","title"])],64))}}),M={class:""},R={for:"explore"},V={class:"p-0"},z={class:"flex items-center gap-8"},B={class:"avatar h-14"},H={class:"w-12 h-12 mask mask-squircle hover:w-14 hover:h-14"},K={class:"w-64"},L={class:"overflow-hidden font-bold whitespace-nowrap text-ellipsis"},W=["onClick"],Y=e({__name:"index",setup(e){const{t:s}=a(),i=x().globalConfig,{getImageList:m}=y(i),g=l(0),b=t.createInstance({name:"imgStore"}),h=l(!1);return n(()=>g.value,e=>{0!==e&&setTimeout(()=>{g.value=0},2e3)}),(e,a)=>(u(),o(r,null,[c(F,{visible:h.value,"onUpdate:visible":a[0]||(a[0]=e=>h.value=e)},null,8,["visible"]),v("div",null,[c(N,{title:p(s)("sidebar.imagesManagement")},{buttons:f(()=>[v("div",M,[v("label",R,[v("span",{class:"btn btn-primary btn-sm",onClick:a[1]||(a[1]=e=>h.value=!0)},d(p(s)("button.upload")),1)])])]),_:1},8,["title"]),v("ul",V,[(u(!0),o(r,null,w(p(m),e=>(u(),o("li",{key:e.id,class:"mb-3"},[v("div",z,[v("div",B,[v("div",H,[c(_,{"img-item":e},null,8,["img-item"])])]),v("div",K,[v("div",L,d(e.name),1)]),v("div",null,[v("button",{class:"btn btn-error btn-xs",onClick:a=>function(e){"Storage"===e.url&&b.removeItem(e.id).then(()=>{i.removeImage(e.id)}),i.removeImage(e.id)}(e)},d(p(s)("button.delete")),9,W)])])]))),128))])])],64))}});export{Y as default};
