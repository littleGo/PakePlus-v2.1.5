import{d as e,l as t,a4 as a,r as l,u as s,w as i,c as n,z as o,K as u,o as r,R as c,h as p,b as m,g as b,T as d,Y as v,v as f,x as g,a as y,n as k,V as h,W as x,i as C}from"./chunk-gpwU6gGF.js";import{_ as w}from"./chunk-BgADtg68.js";import{u as _,b as M}from"./chunk-CvT-8fpa.js";import{_ as j}from"./chunk-NcZwzitX.js";import"./chunk-DsM932Ci.js";const N={class:"flex flex-col items-center gap-6 w-full px-12"},U=["disabled"],D=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:g}=t(),y=a.useToast(),k=l("audio/*"),h=s(e,"visible"),x=_().globalConfig,C=i.createInstance({name:"audioStore"}),w=l(null),D=n({get:()=>w.value?.fileName||null,set(e){w.value&&e&&(w.value.fileName=e)}}),I=l();async function S(e){if(!e)return void(w.value=null);/audio*/.test(e?.type||"")?w.value=e:y.open({message:g("error.notAudioFile"),type:"error",position:"top-right"})}function F(){if(w.value){const{data:e,fileName:t}=w.value,a=f();C.setItem(a,{data:e,fileName:t}).then(()=>{y.open({message:g("error.uploadSuccess"),type:"success",position:"top-right"}),async function(){(await C.keys()).length>0&&C.iterate((e,t)=>{x.addMusic({id:t,name:e.fileName,url:"Storage"})})}()}).catch(()=>{y.open({message:g("error.uploadFail"),type:"error",position:"top-right"})})}}return o(h,e=>{e&&I.value.showDialog()}),(e,t)=>(r(),u(M,{ref_key:"uploadDialogRef",ref:I,visible:h.value,"onUpdate:visible":t[1]||(t[1]=e=>h.value=e),title:p(g)("dialog.uploadAudioTitle"),"submit-func":F,class:""},{content:c(()=>[m("div",N,[h.value?(r(),u(j,{key:0,"limit-type":k.value,onUploadFile:S},null,8,["limit-type"])):b("",!0),d(m("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.value=e),disabled:null===w.value,type:"text",class:"input w-full"},null,8,U),[[v,D.value]])])]),_:1},8,["visible","title"]))}}),I={class:"flex gap-3"},S={for:"explore"},F={class:"p-0"},L=["title"],T={class:"link hover:text-primary"},A={class:"flex gap-3"},R=["onClick"],V=["onClick"],q=e({__name:"index",setup(e){const{t:a}=t(),s=i.createInstance({name:"audioStore"}),n=_().globalConfig,{getMusicList:o}=g(n),u=l(o),b=l(!1);function d(){n.resetMusicList(),s.clear()}function v(){n.clearMusicList(),s.clear()}return(e,t)=>(r(),y(h,null,[k(D,{visible:b.value,"onUpdate:visible":t[0]||(t[0]=e=>b.value=e)},null,8,["visible"]),m("div",null,[k(w,{title:p(a)("sidebar.musicManagement")},{buttons:c(()=>[m("div",I,[m("button",{class:"btn btn-primary btn-sm",onClick:d},C(p(a)("button.reset")),1),m("label",S,[m("span",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>b.value=!0)},C(p(a)("button.upload")),1)]),m("button",{class:"btn btn-error btn-sm",onClick:v},C(p(a)("button.allDelete")),1)])]),_:1},8,["title"]),m("div",null,[m("ul",F,[(r(!0),y(h,null,x(u.value,e=>(r(),y("li",{key:e.id,class:"flex items-center gap-6 pb-2 mb-3"},[m("div",{class:"mr-12 overflow-hidden w-72 whitespace-nowrap text-ellipsis",title:e.name},[m("a",T,C(e.name),1)],8,L),m("div",A,[m("button",{class:"btn btn-primary btn-xs",onClick:t=>async function(e){n.setCurrentMusic(e,!1)}(e)},C(p(a)("button.play")),9,R),m("button",{class:"btn btn-error btn-xs",onClick:t=>function(e){n.removeMusic(e.id),s.removeItem(e.name)}(e)},C(p(a)("button.delete")),9,V)])]))),128))])])])],64))}});export{q as default};
